//LINK PARA RODAR: https://code.earthengine.google.com/07f5720ad53784e7909c4989b4f52b87

//INDICES ESPECTRAIS PARA VEGETAÇÃO.

//AREAS DE ESTUDO: (DEFINIÇÃO DOS POLIGONOS)
var pastagem = /* color: #d63000 */ee.Geometry.Polygon(
        [[[-63.61279414286841, -8.72850226932531],
          [-63.59082148661841, -8.759042209289866],
          [-63.62652705302466, -8.777364970008593],
          [-63.652619582321535, -8.757684931816767],
          [-63.67321894755591, -8.791615380758474],
          [-63.64025996318091, -8.791615380758474],
          [-63.641633254196535, -8.811972159338854],
          [-63.65193293681372, -8.81400777557479],
          [-63.6505596457981, -8.828935285158455],
          [-63.671845656540285, -8.83300631934133],
          [-63.66223261943091, -8.843862190686632],
          [-63.64643977275122, -8.84725458487013],
          [-63.63682673564185, -8.859466944982485],
          [-63.59974787821997, -8.858788491170719],
          [-63.58738825907935, -8.884568854919628],
          [-63.55236933818091, -8.884568854919628],
          [-63.51117060771216, -8.89135286001884],
          [-63.47615168681372, -8.88592566598772],
          [-63.490571242477785, -8.853360815607639],
          [-63.520783644821535, -8.851325416620966],
          [-63.52215693583716, -8.83300631934133],
          [-63.5242168723606, -8.811972159338854],
          [-63.509797316696535, -8.809936531891374],
          [-63.50567744364966, -8.829613793976261],
          [-63.4967510520481, -8.828935285158455],
          [-63.48370478739966, -8.839112786328519],
          [-63.482331496384035, -8.854717742008596],
          [-63.454865676071535, -8.889996069048726],
          [-63.45623896708716, -8.91780927837934],
          [-63.43495295634497, -8.917130932598191],
          [-63.43495295634497, -8.935445826085845],
          [-63.42877314677466, -8.935445826085845],
          [-63.42259333720435, -8.906277228787594],
          [-63.43495295634497, -8.905598861597154],
          [-63.43701289286841, -8.892709645962597],
          [-63.42602656474341, -8.892031253619056],
          [-63.515290480759035, -8.709498378024996],
          [-63.53657649150122, -8.7244300882978],
          [-63.548249465134035, -8.723751387141252],
          [-63.55305598368872, -8.716964307740673],
          [-63.58876155009497, -8.729180961843735],
          [-63.60730097880591, -8.719679154298689]]]),
    conservacao = /* color: #98ff00 */ee.Geometry.Polygon(
        [[[-63.36364962771216, -8.473976307990046],
          [-63.37944240785492, -8.501140937272368],
          [-63.28537304087611, -8.530340890960666],
          [-63.003167604807224, -8.532377754685998],
          [-62.99492805183769, -8.388395135677605],
          [-62.994926366289214, -8.377526629435271],
          [-63.088309001556055, -8.359865482319465],
          [-63.17757144463383, -8.348995557804672],
          [-63.34373738806472, -8.336765717662423],
          [-63.3506037249989, -8.42507513587274],
          [-63.35884244257334, -8.459034498320433]]]),
    plantio = 
    /* color: #00ffff */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-53.07283942608196, -18.052521540187954],
          [-53.106485055964775, -17.991796582300434],
          [-53.12090461162884, -18.019876315837163],
          [-53.16484836530046, -18.017265655904723],
          [-53.17034308819134, -18.04207572741055],
          [-53.18956916241009, -18.05121584752764],
          [-53.227334665339775, -18.025099958661517],
          [-53.26922004131634, -18.03228221450779],
          [-53.28089301494915, -18.048604433115226],
          [-53.23626105694134, -18.060355492469338],
          [-53.24312751201946, -18.08646614356398],
          [-53.25892035869915, -18.09168780767498],
          [-53.2396942844804, -18.119751587841527],
          [-53.26510016826946, -18.18304173010918],
          [-53.28569953350384, -18.21565655346899],
          [-53.28157966045696, -18.237831144744128],
          [-53.21154181866009, -18.240439734351963],
          [-53.19506232647259, -18.258698765408475],
          [-53.17171637920696, -18.256090449883956],
          [-53.17308967022259, -18.276955876937503],
          [-53.17034308819134, -18.305641741424363],
          [-53.128457712214775, -18.29847072041579],
          [-53.11403815655071, -18.318027351051335],
          [-53.08245246319134, -18.31867920069454],
          [-53.06597297100384, -18.269131635718068],
          [-53.0419403782304, -18.243048284819512],
          [-53.05361335186321, -18.192174495843624],
          [-53.09069220928509, -18.140633343014404],
          [-53.12813411641676, -18.109617342380545],
          [-53.124014243369885, -18.076329973790244]]]);


//Áreas:
var past = pastagem
var conserv = conservacao


// Applies scaling factors.
function applyScaleFactors(image) {
  var opticalBands = image.select('SR_B.').multiply(0.0000275).add(-0.2);
  var thermalBands = image.select('ST_B.*').multiply(0.00341802).add(149.0);
  return image.addBands(opticalBands, null, true)
              .addBands(thermalBands, null, true);
}

function EVI (image) {
  var evi = image.expression(
  '(2.5 * ((NIR-RED) / (NIR + 6 * RED - 7.5* BLUE +1)))*(1+1)', {
    NIR:image.select('SR_B5'),
    RED:image.select('SR_B4'),
    BLUE:image.select('SR_B2')
  }).rename('EVI')
return image.addBands(evi)
}

function NDVI (image) {
  var ndvi = image.expression(
  '((NIR-RED) / (NIR + RED))', {
    NIR:image.select('SR_B5'),
    RED:image.select('SR_B4')}).rename('NDVI')
return image.addBands(ndvi)
}

var visualization = {
  bands: ['SR_B4', 'SR_B3', 'SR_B2'],
  min: 0.0,
  max: 0.3,
};

var dataset = ee.ImageCollection('LANDSAT/LC08/C02/T1_L2')
    .filterDate('2015-01-01', '2022-01-01')
    .filterMetadata('CLOUD_COVER', 'less_than', 15)
    .map(applyScaleFactors)
    .map(EVI)
    .map(NDVI);
    //.filterBounds(past)
    //.filterBounds(conserv);
    

Map.setCenter(-63.12, -8.12, 8);
Map.addLayer(dataset.select('NDVI'), {min: 0.0, max: 1.0}, 'NDVI');
Map.addLayer((dataset.select('EVI')), {min: 0.0, max: 1.0}, 'EVI');
Map.addLayer(dataset, visualization, 'True Color (432)');
Map.centerObject(conserv, 10);


//para fazer a média nos poligonos
var chart_past = ui.Chart.image.series({
  imageCollection: dataset.select('NDVI', 'EVI'), 
  region: past,
  reducer: ee.Reducer.mean(),
  scale: 30
});

var chart_conserv = ui.Chart.image.series({
  imageCollection: dataset.select('NDVI', 'EVI'), 
  region: conserv,
  reducer: ee.Reducer.mean(),
  scale: 30
});

//para imprimir o gráfico
chart_past.style().set({
  position: 'bottom-right',
  width: '250px',
  height: '250px'
});
chart_past.setOptions({
  title: 'Pastagem: 2015-2022',
  vAxis: {title: 'valores do índice'},
  hAxis: {title: 'período', format: 'MM-YY', gridlines: {count: 7}},
});
Map.add(chart_past);

chart_conserv.style().set({
  position: 'top-right',
  width: '250px',
  height: '250px'
});
chart_conserv.setOptions({
  title: 'Un. Conservação: 2015-2022',
  vAxis: {title: 'valores do índice'},
  hAxis: {title: 'período', format: 'MM-YY', gridlines: {count: 7}},
});
Map.add(chart_conserv);
